#!/usr/bin/env bash

# Build production styles
clojure -M:prod -m rtc.env

# Build JS assets
yarn
clojure -M:cljs-build release app

# Bundle all assets in an uberjar
cd "$( dirname "${BASH_SOURCE[0]}" )"
clojure -m uberdeps.uberjar --deps-file ../deps.edn --target ../target/rtc.jar --aliases prod

# Cleanup after ourselves to avoid interfering with the dev env
# TODO make it so dev just ignores manifest.edn
rm -rf resources/public/css/manifest.edn
